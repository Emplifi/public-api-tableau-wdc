let $aggregatedPostMetrics=$("#aggregatedPostMetrics"),$missingProfileLabels=$("#missingProfileLabels"),$aggregatedPostMetricsSpinner=$("#aggregatedPostMetricsSpinner").hide(),$dimensionsSelect=$("#aggregated_post_dimensions"),$aggregatedPostMetricsSelect=$("#aggregated_post_metrics"),$aggregatedPostTimedimension=$("#aggregated_post_timedimension");async function onAggregatedPostMetricsSubmit(e){e.preventDefault(),$aggregatedPostMetricsSpinner.show(),SBKS.aggregated_post_metrics=[],SBKS.aggregated_post_dimensions=[];for(const e of $aggregatedPostMetrics.serializeArray())"daterange"!==e.name?"time"!==e.name?(SBKS[e.name]=SBKS[e.name]||[],SBKS[e.name].push(e.value)):e.value&&SBKS.aggregated_post_dimensions.unshift(e.value):SBKS.date_range=parseDateRange(e.value);tableau.connectionData=JSON.stringify(SBKS),invokeConnector(SBKS.data_source)}function renderAggregatedPostMetrics(){$aggregatedPostMetrics.show(),$missingProfileLabels.empty();let e=[],t=[];for(const[n,a]of Object.entries(SBKS.profiles_selected)){let i=Object.entries(a).find((e=>e[1]?e:null));for(const t of Object.keys(AGGREGATED_POST_METRICS[n]))(i||0!==t.indexOf("insights"))&&(e.find((e=>e.id===t))||e.push({id:t,text:t}));t=[...t,...Object.keys(a).filter((e=>SBKS.profiles_with_no_labels[n].includes(e)))]}$("select").each((function(){$(this).outerWidth()>10&&$(this).css({width:$(this).outerWidth()-1+"px"})})),$aggregatedPostMetricsSelect.select2({multiple:!0,data:e}).change(onMetricsChange),$aggregatedPostTimedimension.change(onMetricsChange),t.length&&$missingProfileLabels.append($(`\n        <div class="alert alert-info" role="alert">\n            Some profiles you selected don't have profile labels. If you select profile_label as a dimension\n            the data for that profile will not be shown.<br>\n            Profiles: ${t.map((e=>SBKS.profile_name_by_id[e])).join(", ")}\n        </div>\n        `))}function onMetricsChange(){let e=[];for(const t of $aggregatedPostMetricsSelect.val())for(const n of Object.keys(SBKS.profiles_selected)){let a=AGGREGATED_POST_METRICS[n][t];a&&(e=e.length?intersect(e,a):a)}$aggregatedPostMetricsSelect.val().includes("sentiment_manual_auto")&&$dimensionsSelect.val("sentiment");let t=$dimensionsSelect.val();$dimensionsSelect.empty().select2({multiple:!0,data:e.map((e=>({id:e,text:e}))),maximumSelectionLength:""===$aggregatedPostTimedimension.val()?2:1}).val(t).trigger("change")}function createHeaders(){return{"Content-Type":"application/json; charset=utf-8",Authorization:`Basic ${btoa(`${tableau.username}:${tableau.password}`)}`,"x-api-consumer":"Tableau V3"}}async function callSbksApi(e,t,n){let a=await fetch(SBKS.apiUrl+e,{method:t,headers:createHeaders(),body:n?JSON.stringify(n):null});return await a.json()}async function doApiCall(e,t,n){let a=await callSbksApi(e,"POST",n);if(a.success){if(a.header)for(const[e,n]of a.header.entries())"profile_label"===n.type?a.header[e].rows=n.rows.map((e=>{let n=t.profile_labels.find((t=>t.id===e));return n?n.name:e})):"post_labels"===n.type&&(a.header[e].rows=n.rows.map((e=>{let n=t.post_labels.find((t=>t.id===e));return n?n.name:e})));return a}console.log("API Request Failed",a)}function chunkArray(e,t){let n=0,a=[];const i=e.length;for(n=0;n<i;n+=t)a.push(e.slice(n,n+t));return a}function splitDateRange(e,t,n){const a=moment(t);let i=Array.from(moment.range(moment(e),a).by("days",{step:n}));i.push(a);let s={},o=null;for(const e of i)o?(s[o.format("YYYY-MM-DD")]=e.format("YYYY-MM-DD"),o=e.add(1,"day")):o=e;return s}function combineMerge(e,t,n){let a=e.slice();for(const[i,s]of t.entries())void 0===a[i]?a[i]=n.cloneUnlessOtherwiseSpecified(s,n):n.isMergeableObject(s)?a[i]=deepmerge(e[i],s,n):-1===e.indexOf(s)&&a.push(s);return a}function intersect(e,t){return e.filter(Set.prototype.has,new Set(t))}function parseDateRange(e){let[t,n]=e.split(" - ");return t=moment(t,"MM/DD/YYYY"),n=moment(n,"MM/DD/YYYY"),{start:t.format("YYYY-MM-DD"),end:n.format("YYYY-MM-DD"),end_today:n.isSame(moment(),"day")}}function adjustDateRange(e){let t=moment(e.start,"YYYY-MM-DD"),n=moment(e.end,"YYYY-MM-DD");return e.end_today&&(n=moment().format("YYYY-MM-DD"),t=t.add(moment().diff(n,"days"),"days").format("YYYY-MM-DD")),{start:t,end:n}}$((function(){$aggregatedPostMetrics.submit(onAggregatedPostMetricsSubmit)})),$((function(){window["moment-range"].extendMoment(moment),$("input[name=daterange]").daterangepicker({startDate:moment().subtract(29,"days"),endDate:moment(),minDate:"01/01/2008",maxDate:moment(),alwaysShowCalendars:!0,showDropdowns:!0,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"This Year":[moment().startOf("year"),moment()],"Last Year":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")]}})}));let SBKS={apiUrl:"https://api.socialbakers.com/",postsUrl:{facebook:"3/facebook/page/posts",instagram:"3/instagram/profile/posts",youtube:"3/youtube/profile/videos",twitter:"3/twitter/profile/tweets",linkedin:"3/linkedin/profile/posts",pinterest:"3/pinterest/profile/posts",vkontakte:"3/vkontakte/profile/posts"},data_source:"profile",networks:["facebook","instagram","twitter","youtube","linkedin","pinterest","vkontakte"],icons:{facebook:"logo-facebook",instagram:"logo-instagram",twitter:"logo-twitter",youtube:"logo-youtube",linkedin:"logo-linkedin",pinterest:"logo-pinterest",vk:"logo-vk"},profiles:{},profiles_selected:{},profile_labels:[],post_labels:[],profile_labels_selected:[],profile_metrics:{},profile_dimensions:{},profiles_with_no_labels:{},profile_name_by_id:{},aggregated_post_metrics:[],aggregated_post_dimensions:[],posts_filters:{},posts_networks:{}},PROFILE_COMMON_DIMENSIONS=["profile","profile_label"],PROFILE_METRICS={facebook:{fans_change:PROFILE_COMMON_DIMENSIONS,fans_lifetime:PROFILE_COMMON_DIMENSIONS,insights_activity:PROFILE_COMMON_DIMENSIONS.concat(["activity_type"]),insights_activity_unique:PROFILE_COMMON_DIMENSIONS.concat(["activity_type","gender_age","city","country","locale"]),insights_engaged_users:PROFILE_COMMON_DIMENSIONS,insights_fan_adds:PROFILE_COMMON_DIMENSIONS.concat(["like_source"]),insights_fan_adds_unique:PROFILE_COMMON_DIMENSIONS.concat(["like_source"]),insights_fan_removes:PROFILE_COMMON_DIMENSIONS,insights_fan_removes_unique:PROFILE_COMMON_DIMENSIONS.concat(["unlike_source"]),insights_fans_lifetime:PROFILE_COMMON_DIMENSIONS.concat(["gender_age","city","country","locale"]),insights_fans_online:PROFILE_COMMON_DIMENSIONS.concat(["hour_of_day"]),insights_impressions:PROFILE_COMMON_DIMENSIONS.concat(["activity_type","post_attribution"]),insights_negative_feedback:PROFILE_COMMON_DIMENSIONS,insights_positive_feedback:PROFILE_COMMON_DIMENSIONS.concat(["positive_feedback_type"]),insights_post_clicks:PROFILE_COMMON_DIMENSIONS.concat(["click_type"]),insights_post_clicks_unique:PROFILE_COMMON_DIMENSIONS.concat(["click_type"]),insights_post_impressions:PROFILE_COMMON_DIMENSIONS.concat(["post_attribution"]),insights_post_reach:PROFILE_COMMON_DIMENSIONS.concat(["post_attribution","frequency_distribution"]),insights_reach:PROFILE_COMMON_DIMENSIONS.concat(["gender_age","post_attribution"]),insights_reach_28_days:PROFILE_COMMON_DIMENSIONS.concat(["gender_age"]),insights_reach_7_days:PROFILE_COMMON_DIMENSIONS.concat(["gender_age"]),insights_reach_engagement:PROFILE_COMMON_DIMENSIONS,insights_reactions:PROFILE_COMMON_DIMENSIONS.concat(["reaction_type"]),insights_video_complete_views_30s:PROFILE_COMMON_DIMENSIONS.concat(["play_type","post_attribution"]),insights_video_complete_views_30s_repeat_views:PROFILE_COMMON_DIMENSIONS,insights_video_complete_views_30s_unique:PROFILE_COMMON_DIMENSIONS,insights_video_repeat_views:PROFILE_COMMON_DIMENSIONS,insights_video_views:PROFILE_COMMON_DIMENSIONS.concat(["play_type","post_attribution"]),insights_video_views_unique:PROFILE_COMMON_DIMENSIONS,insights_views:PROFILE_COMMON_DIMENSIONS},instagram:{followers_change:PROFILE_COMMON_DIMENSIONS,followers_lifetime:PROFILE_COMMON_DIMENSIONS,following_change:PROFILE_COMMON_DIMENSIONS,following_lifetime:PROFILE_COMMON_DIMENSIONS,insights_followers:PROFILE_COMMON_DIMENSIONS.concat(["country","locale","city","gender_age"]),insights_impressions:PROFILE_COMMON_DIMENSIONS,insights_impressions_28_days:PROFILE_COMMON_DIMENSIONS,insights_impressions_7_days:PROFILE_COMMON_DIMENSIONS,insights_profile_clicks:PROFILE_COMMON_DIMENSIONS.concat(["click_target"]),insights_profile_views:PROFILE_COMMON_DIMENSIONS,insights_reach:PROFILE_COMMON_DIMENSIONS,insights_reach_28_days:PROFILE_COMMON_DIMENSIONS,insights_reach_7_days:PROFILE_COMMON_DIMENSIONS},twitter:{ff_ratio:PROFILE_COMMON_DIMENSIONS,followers_change:PROFILE_COMMON_DIMENSIONS,followers_lifetime:PROFILE_COMMON_DIMENSIONS,following_change:PROFILE_COMMON_DIMENSIONS,following_lifetime:PROFILE_COMMON_DIMENSIONS,listed_change:PROFILE_COMMON_DIMENSIONS,listed_lifetime:PROFILE_COMMON_DIMENSIONS},youtube:{interaction_change:PROFILE_COMMON_DIMENSIONS.concat(["interaction_type"]),interactions_per_1k_fans:PROFILE_COMMON_DIMENSIONS,subscribers_change:PROFILE_COMMON_DIMENSIONS,subscribers_lifetime:PROFILE_COMMON_DIMENSIONS,video_lifetime:PROFILE_COMMON_DIMENSIONS,viewed_time_change:PROFILE_COMMON_DIMENSIONS,views_change:PROFILE_COMMON_DIMENSIONS},linkedin:{followers_change:PROFILE_COMMON_DIMENSIONS,followers_lifetime:PROFILE_COMMON_DIMENSIONS},pinterest:{boards_change:PROFILE_COMMON_DIMENSIONS,boards_lifetime:PROFILE_COMMON_DIMENSIONS,followers_change:PROFILE_COMMON_DIMENSIONS,followers_lifetime:PROFILE_COMMON_DIMENSIONS,following_change:PROFILE_COMMON_DIMENSIONS,following_lifetime:PROFILE_COMMON_DIMENSIONS,pins_lifetime:PROFILE_COMMON_DIMENSIONS}},common_agg_dimensions=["platform","profile","post_labels","profile_label"],insights_engagements=common_agg_dimensions.concat(["media_type","content_type"]),engagement_rate=insights_engagements.concat(["published_status","sentiment_type"]),insights_video_views=common_agg_dimensions.concat(["content_type","published_status","sentiment_type"]),interactions=engagement_rate.concat(["interaction_type"]),likes=common_agg_dimensions.concat(["media_type","sentiment_type"]),sentiment_manual_auto=common_agg_dimensions.concat(["media_type","sentiment"]),shares=insights_engagements.concat(["published_status"]),user_posts_responded=insights_engagements.concat(["response_time"]),AGGREGATED_POST_METRICS={facebook:{engagement_rate:engagement_rate,insights_engagements:insights_engagements,insights_impressions:engagement_rate,insights_post_clicks:common_agg_dimensions.concat(["content_type","media_type","published_status"]),insights_reach_engagement:common_agg_dimensions.concat(["content_type","media_type","published_status"]),insights_reach_per_content:engagement_rate,insights_video_views:insights_video_views,interactions:interactions,interactions_per_1k_fans:engagement_rate,likes:likes,number_of_comments:engagement_rate,page_posts:engagement_rate,page_shares:common_agg_dimensions,sentiment_manual_auto:sentiment_manual_auto,shares:shares,user_posts:insights_engagements,user_posts_average_response_time:insights_engagements,user_posts_responded:user_posts_responded,user_posts_response_rate:insights_engagements,user_questions_average_response_time:insights_engagements,user_questions_responded:user_posts_responded,user_questions_response_rate:engagement_rate},instagram:{engagement_rate:engagement_rate,insights_completion_rate:common_agg_dimensions.concat(["media_type"]),insights_engagements:insights_engagements,insights_impressions:engagement_rate,insights_reach_per_content:engagement_rate,insights_story_exits:common_agg_dimensions.concat(["media_type"]),insights_story_taps_back:common_agg_dimensions.concat(["media_type"]),insights_story_taps_forward:common_agg_dimensions.concat(["media_type"]),insights_video_views:insights_video_views,interactions:interactions,interactions_per_1k_fans:engagement_rate,likes:likes,number_of_comments:engagement_rate,page_posts:engagement_rate,sentiment_manual_auto:sentiment_manual_auto},twitter:{engagement_rate:engagement_rate,insights_engagements:insights_engagements,insights_impressions:engagement_rate,insights_media_views:common_agg_dimensions.concat(["content_type","media_type","sentiment_type"]),insights_video_views:insights_video_views,interactions:interactions,interactions_per_1k_fans:engagement_rate,likes:likes,number_of_comments:engagement_rate,page_posts:engagement_rate,page_replies:common_agg_dimensions,page_shares:common_agg_dimensions,profile_tweets:common_agg_dimensions.concat(["media_type"]),sentiment_manual_auto:sentiment_manual_auto,shares:shares,user_posts:insights_engagements,user_posts_average_response_time:insights_engagements,user_posts_responded:user_posts_responded,user_posts_response_rate:insights_engagements,user_questions_average_response_time:insights_engagements,user_questions_responded:user_posts_responded,user_questions_response_rate:engagement_rate},youtube:{engagement_rate:engagement_rate,insights_video_views:insights_video_views,interactions:interactions,interactions_per_1k_fans:engagement_rate,likes:likes,number_of_comments:engagement_rate,page_posts:engagement_rate},linkedin:{engagement_rate:engagement_rate,interactions:interactions,interactions_per_1k_fans:engagement_rate,number_of_comments:engagement_rate,page_posts:engagement_rate,sentiment_manual_auto:sentiment_manual_auto},pinterest:{interactions:interactions,number_of_comments:engagement_rate,page_posts:engagement_rate,page_shares:common_agg_dimensions,shares:shares},vkontakte:{engagement_rate:engagement_rate,interactions:interactions,interactions_per_1k_fans:engagement_rate,number_of_comments:engagement_rate,page_posts:engagement_rate,shares:shares}},ID_NAME_URL={id:tableau.dataTypeEnum.string,name:tableau.dataTypeEnum.string,url:tableau.dataTypeEnum.string},POSTS_SORT_FIELDS={comments:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],created_time:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],interactions:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],interactions_per_1k_fans:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],reactions:["facebook","linkedin"],"reactions_by_type.anger":["facebook"],"reactions_by_type.haha":["facebook"],"reactions_by_type.like":["facebook"],"reactions_by_type.love":["facebook"],"reactions_by_type.sorry":["facebook"],"reactions_by_type.wow":["facebook"],shares:["facebook","pinterest","vkontakte"],insights_engaged_users:["facebook"],insights_post_clicks:["facebook"],"insights_reach_by_post_attribution.organic":["facebook"],"insights_reach_by_post_attribution.paid":["facebook"],insights_reach_engagement_rate:["facebook"],insights_video_view_time_average:["facebook"],insights_video_views_10s:["facebook"],"insights_video_views_by_post_attribution.organic":["facebook"],"insights_video_views_by_post_attribution.paid":["facebook"],likes:["instagram","youtube","vkontakte"],insights_impressions:["instagram"],insights_reach:["instagram"],insights_saves:["instagram"],insights_story_completion_rate:["instagram"],insights_story_exits:["instagram"],insights_story_taps_back:["instagram"],insights_story_taps_forward:["instagram"],insights_video_views:["instagram"],dislikes:["youtube"],duration:["youtube"],video_view_time:["youtube"],video_views:["youtube"]},POSTS_FILTER_FIELDS={content_type:{facebook:["post","shared"],instagram:["post","story"],twitter:[],youtube:[],linkedin:[],pinterest:["post","shared"],vkontakte:[]},grade:{facebook:["A+","A","B","C","D"],instagram:["A+","A","B","C","D"],youtube:[],twitter:[],linkedin:[],pinterest:[],vkontakte:[]},media_type:{facebook:["status","link","video","note","poll","offer","photo","carousel"],instagram:["video","photo","carousel"],youtube:["video"],twitter:[],linkedin:["status","link","video","photo","album","carousel"],pinterest:[],vkontakte:["status","photo","video","link","note","poll","album"]},origin:{facebook:["User-Generated Content","Brand's Content"],instagram:[],youtube:[],twitter:["User-Generated Content","Brand's Content"],linkedin:[],pinterest:[],vkontakte:["User-Generated Content","Brand's Content"]},post_attribution:{facebook:["organic","paid"],instagram:["organic","paid"],youtube:[],twitter:[],linkedin:[],pinterest:[],vkontakte:[]},video_type:{facebook:["crosspost","crosspostable","live","shared"],instagram:[],youtube:[],twitter:[],linkedin:[],pinterest:[],vkontakte:[]},post_labels:{facebook:[],instagram:[],youtube:[],twitter:[],linkedin:[],pinterest:[],vkontakte:[]}},POSTS_FIELDS={attachments:{networks:["facebook","instagram","linkedin","pinterest","vkontakte"],array:!0,subfields:{title:tableau.dataTypeEnum.string,description:tableau.dataTypeEnum.string,type:tableau.dataTypeEnum.string,url:tableau.dataTypeEnum.string,image_url:tableau.dataTypeEnum.string}},author:{networks:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],subfields:ID_NAME_URL},channel:{networks:["youtube"],subfields:ID_NAME_URL},comments:{networks:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.int},comments_sentiment:{networks:["facebook"],subfields:{positive:tableau.dataTypeEnum.int,neutral:tableau.dataTypeEnum.int,negative:tableau.dataTypeEnum.int}},content:{networks:["facebook","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.string},content_type:{networks:["facebook","instagram","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.string},created_time:{networks:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.datetime},deleted:{networks:["facebook"],type:tableau.dataTypeEnum.bool},description:{networks:["youtube"],type:tableau.dataTypeEnum.string},dislikes:{networks:["youtube"],type:tableau.dataTypeEnum.int},duration:{networks:["youtube"],type:tableau.dataTypeEnum.int},grade:{networks:["facebook","instagram"],type:tableau.dataTypeEnum.string},hidden:{networks:["facebook"],type:tableau.dataTypeEnum.bool},id:{networks:["facebook","instagram","youtube","twitter","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.string},interactions:{networks:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.int},interactions_per_1k_fans:{networks:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.float},likes:{networks:["instagram","youtube","vkontakte"],type:tableau.dataTypeEnum.int},media_type:{networks:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.string},origin:{networks:["facebook","twitter","vkontakte"],type:tableau.dataTypeEnum.string},page:{networks:["facebook","instagram","linkedin","vkontakte"],subfields:ID_NAME_URL},post_attribution:{networks:["facebook","instagram"],subfields:{status:tableau.dataTypeEnum.string,type:tableau.dataTypeEnum.string}},post_labels:{networks:["facebook","instagram","youtube","twitter","linkedin","pinterest","vkontakte"],array:!0,subfields:{id:tableau.dataTypeEnum.string,name:tableau.dataTypeEnum.string}},profile:{networks:["twitter","pinterest"],subfields:ID_NAME_URL},published:{networks:["facebook"],type:tableau.dataTypeEnum.bool},reactions:{networks:["facebook","linkedin"],type:tableau.dataTypeEnum.int},reactions_by_type:{networks:["facebook"],subfields:{like:tableau.dataTypeEnum.int,love:tableau.dataTypeEnum.int,wow:tableau.dataTypeEnum.int,haha:tableau.dataTypeEnum.int,sorry:tableau.dataTypeEnum.int,anger:tableau.dataTypeEnum.int}},sentiment:{networks:["facebook","instagram"],type:tableau.dataTypeEnum.string},shares:{networks:["facebook","pinterest","vkontakte"],type:tableau.dataTypeEnum.int},spam:{networks:["facebook"],type:tableau.dataTypeEnum.bool},universal_video_id:{networks:["facebook"],type:tableau.dataTypeEnum.int},url:{networks:["facebook","instagram","youtube","linkedin","pinterest","vkontakte"],type:tableau.dataTypeEnum.string},video:{networks:["facebook"],subfields:{id:tableau.dataTypeEnum.string,length:tableau.dataTypeEnum.int,crosspost:tableau.dataTypeEnum.bool,crosspostable:tableau.dataTypeEnum.bool,live:tableau.dataTypeEnum.bool,shared:tableau.dataTypeEnum.bool}},video_view_time:{networks:["youtube"],type:tableau.dataTypeEnum.int},video_views:{networks:["youtube"],type:tableau.dataTypeEnum.int},insights_engaged_users:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_engagement:{networks:["instagram"],type:tableau.dataTypeEnum.int},insights_engagement_by_engagement_type:{networks:["instagram"],subfields:{comments:tableau.dataTypeEnum.int,likes:tableau.dataTypeEnum.int,saves:tableau.dataTypeEnum.int}},insights_impressions:{networks:["facebook","instagram"],type:tableau.dataTypeEnum.int},insights_impressions_by_post_attribution:{networks:["facebook"],subfields:{paid:tableau.dataTypeEnum.int,organic:tableau.dataTypeEnum.int,viral:tableau.dataTypeEnum.int}},insights_interactions:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_interactions_by_interaction_type:{networks:["facebook"],subfields:{comment:tableau.dataTypeEnum.int,like:tableau.dataTypeEnum.int,share:tableau.dataTypeEnum.int}},insights_negative_feedback_unique:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_post_clicks:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_post_clicks_by_clicks_type:{networks:["facebook"],subfields:{link_clicks:tableau.dataTypeEnum.int,button_clicks:tableau.dataTypeEnum.int,other_clicks:tableau.dataTypeEnum.int,photo_views:tableau.dataTypeEnum.int,video_plays:tableau.dataTypeEnum.int}},insights_post_clicks_unique:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_reach:{networks:["facebook","instagram"],type:tableau.dataTypeEnum.int},insights_reach_by_post_attribution:{networks:["facebook"],subfields:{paid:tableau.dataTypeEnum.int,organic:tableau.dataTypeEnum.int,viral:tableau.dataTypeEnum.int}},insights_reach_engagement_rate:{networks:["facebook"],type:tableau.dataTypeEnum.float},insights_reactions:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_reactions_by_type:{networks:["facebook"],subfields:{like:tableau.dataTypeEnum.int,love:tableau.dataTypeEnum.int,wow:tableau.dataTypeEnum.int,haha:tableau.dataTypeEnum.int,sorry:tableau.dataTypeEnum.int,anger:tableau.dataTypeEnum.int}},insights_saves:{networks:["instagram"],type:tableau.dataTypeEnum.int},insights_story_completion_rate:{networks:["instagram"],type:tableau.dataTypeEnum.float},insights_story_exits:{networks:["instagram"],type:tableau.dataTypeEnum.int},insights_story_replies:{networks:["instagram"],type:tableau.dataTypeEnum.int},insights_story_taps_back:{networks:["instagram"],type:tableau.dataTypeEnum.int},insights_story_taps_forward:{networks:["instagram"],type:tableau.dataTypeEnum.int},insights_video_view_time:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_view_time_average:{networks:["facebook"],type:tableau.dataTypeEnum.float},insights_video_view_time_by_distribution:{networks:["facebook"],subfields:{owned:tableau.dataTypeEnum.int,shared:tableau.dataTypeEnum.int}},insights_video_view_time_by_post_attribution:{networks:["facebook"],subfields:{organic:tableau.dataTypeEnum.int,paid:tableau.dataTypeEnum.int}},insights_video_views:{networks:["facebook","instagram"],type:tableau.dataTypeEnum.int},insights_video_views_10s:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_views_10s_by_play_type:{networks:["facebook"],subfields:{autoplayed:tableau.dataTypeEnum.int,click_to_play:tableau.dataTypeEnum.int}},insights_video_views_10s_by_post_attribution:{networks:["facebook"],subfields:{organic:tableau.dataTypeEnum.int,paid:tableau.dataTypeEnum.int}},insights_video_views_10s_by_sound:{networks:["facebook"],subfields:{on:tableau.dataTypeEnum.int,off:tableau.dataTypeEnum.int}},insights_video_views_10s_unique:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_views_30s:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_views_30s_by_play_type:{networks:["facebook"],subfields:{autoplayed:tableau.dataTypeEnum.int,click_to_play:tableau.dataTypeEnum.int}},insights_video_views_30s_by_post_attribution:{networks:["facebook"],subfields:{organic:tableau.dataTypeEnum.int,paid:tableau.dataTypeEnum.int}},insights_video_views_30s_unique:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_views_average_completion:{networks:["facebook"],type:tableau.dataTypeEnum.float},insights_video_views_by_play_type:{networks:["facebook"],subfields:{autoplayed:tableau.dataTypeEnum.int,click_to_play:tableau.dataTypeEnum.int}},insights_video_views_by_post_attribution:{networks:["facebook"],subfields:{organic:tableau.dataTypeEnum.int,paid:tableau.dataTypeEnum.int}},insights_video_views_by_sound:{networks:["facebook"],subfields:{on:tableau.dataTypeEnum.int,off:tableau.dataTypeEnum.int}},insights_video_views_complete:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_views_complete_by_post_attribution:{networks:["facebook"],subfields:{organic:tableau.dataTypeEnum.int,paid:tableau.dataTypeEnum.int}},insights_video_views_complete_unique:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_views_complete_unique_by_post_attribution:{networks:["facebook"],subfields:{organic:tableau.dataTypeEnum.int,paid:tableau.dataTypeEnum.int}},insights_video_views_distribution:{networks:["facebook"],subfields:{owned:tableau.dataTypeEnum.int,shared:tableau.dataTypeEnum.int}},insights_video_views_unique:{networks:["facebook"],type:tableau.dataTypeEnum.int},insights_video_views_unique_by_post_attribution:{networks:["facebook"],subfields:{organic:tableau.dataTypeEnum.int,paid:tableau.dataTypeEnum.int}}},$login=$("#login"),$loginSpinner=$("#loginSpinner").hide();async function fetchProfilesAndLabels(){SBKS.profiles={};let e={};for(const t of SBKS.networks)e[t]=callSbksApi(`3/${t}/profiles`,"GET");let t=callSbksApi("3/profile/labels","GET"),n=callSbksApi("3/post/labels","GET");await Promise.all(Object.values(e));for(const[t,n]of Object.entries(e)){let e={success:!1};try{e=await n}catch(e){return void showModal("Profiles API error",e.toString())}if(!e.success)return showModal("API authorization failed",`API connection failed.<br><br><code>${JSON.stringify(e.errors)}</code>`),-1;if(e.profiles.length){e.profiles.sort(((e,t)=>e.name.localeCompare(t.name))),SBKS.profiles[t]=e.profiles;for(const e of SBKS.profiles[t])SBKS.profile_name_by_id[e.id]=e.name;SBKS.profiles_with_no_labels[t]=SBKS.profiles[t].filter((e=>!e.profile_labels.length)).map((e=>e.id))}}try{let e=await t;if(e.success){e.data.sort(((e,t)=>e.name.localeCompare(t.name)));for(const t of e.data)t.selected_profiles=[];SBKS.profile_labels=e.data}let a=await n;a.success&&(a.data.sort(((e,t)=>e.name.localeCompare(t.name))),SBKS.post_labels=a.data)}catch(e){showModal("Labels API error",e.toString())}$.isEmptyObject(SBKS.profiles)&&showModal("Profiles not available","Your account doesn't have any profiles connected.")}async function onLoginSubmit(e){e.preventDefault(),$loginSpinner.show(),tableau.username=$("#token").val(),tableau.password=$("#secret").val(),-1!=await fetchProfilesAndLabels()?($login.hide(),renderProfiles()):$loginSpinner.hide()}function showModal(e,t){$("#modalTitle").text(e),$("#modalBody").html(t);let n=new bootstrap.Modal(document.getElementById("modal"));$("#modalButton").click((e=>{n.hide()})),n.show()}$((function(){$login.submit(onLoginSubmit),$("#profiles .back").click((function(){$("[id$=Spinner]").hide(),$("#profiles").hide(),$("#login").show()})),$("#profileMetrics .back,#aggregatedPostMetrics .back, #posts .back").click((function(){$("[id$=Spinner]").hide(),$("#profileMetrics, #aggregatedPostMetrics, #posts").hide(),$("#profiles").show()}))}));let $postsDiv=$("#posts"),$posts=$("#postsForm"),$postsSorts=$("#postsSorts"),$postsSpinner=$("#postsSpinner").hide(),$advancedFilteringSwitch=$("#advancedFiltering"),$basicFiltering=$("#basicFiltering");function processFormField(e,t){if(e=e||{},-1!==t.name.indexOf("[]")){let n=t.name.replace("[]","");e[n]=e[n]||[],e[n].push(t.value)}else e[t.name]=t.value;return e}async function onPostsSubmit(e){e.preventDefault(),$postsSpinner.show();let t={},n={};for(const e of $posts.serializeArray()){if(["",void 0,null].includes(e.value))continue;if("daterange"===e.name){SBKS.date_range=parseDateRange(e.value);continue}let a=!1;for(const i of SBKS.networks){if(0===e.name.indexOf(i)){e.name=e.name.replace(`${i}-`,""),n[i]=processFormField(n[i],e),a=!0;break}if(!a&&e.name.indexOf(i)>0){e.name=e.name.replace(`_${i}`,""),t[i]=processFormField(t[i],e),a=!0;break}}a||(t=processFormField(t,e))}SBKS.posts_filters=t,SBKS.posts_networks=n,tableau.connectionData=JSON.stringify(SBKS),invokeConnector(SBKS.data_source)}function renderPosts(){renderPostsSorts($("#advancedFiltering").is(":checked")),$postsDiv.show(),$("select").each((function(){$(this).outerWidth()>10&&$(this).css({width:$(this).outerWidth()-1+"px"})})),$("select[data-sort]").each((function(){let e=$(this),t=e.data("sort"),n=Object.keys(POSTS_SORT_FIELDS).map(((e,n)=>{if(!POSTS_SORT_FIELDS[e].includes(t))return;let a=e.replace(/_/g," ").replace(".",": ");return{id:e,text:a.charAt(0).toUpperCase()+a.slice(1),selected:"created_time"===e}}));e.select2({multiple:!0,minimumResultsForSearch:-1,data:n}).on("select2:select",(function(e){let t=$(e.params.data.element);t.detach(),$(this).append(t),$(this).trigger("change")}))})),$("#post_labels").select2({multiple:!0,data:SBKS.post_labels.map((e=>({id:e.id,text:e.name})))}),$("select[data-fields]").each((function(){let e=$(this),t=e.data("fields"),n=Object.entries(SBKS.profiles_selected[t]).find((e=>e[1]?e:null)),a=[];for(const[e,i]of Object.entries(POSTS_FIELDS))if((!n||0!==e.indexOf("insights"))&&i.networks.includes(t)){let t=e.replace(/_/g," ");a.push({id:e,text:t.charAt(0).toUpperCase()+t.slice(1)})}e.select2({multiple:!0,data:a}).val(["page","profile","channel"]).change()})),$("select.form-select[multiple]").select2()}function toggleAdvancedFiltering(){$basicFiltering.toggle(),renderPosts()}function renderPostsSorts(e){$postsSorts.html(""),filters=e=>"",e&&(filters=e=>`<div class="input-group mb-3" id="content_type_${e}_container">\n            <label for="content_type" class="input-group-text">Content Type</label>\n            <select class="form-select" name="content_type_${e}[]" id="content_type_${e}" multiple>\n            </select>\n            </div>\n            <div class="input-group mb-3" id="grade_${e}_container">\n                <label for="grade" class="input-group-text">Grade</label>\n                <select class="form-select" name="grade_${e}[]" id="grade_${e}" multiple>\n                </select>\n            </div>\n            <div class="input-group mb-3" id="media_type_${e}_container">\n                <label for="media_type" class="input-group-text">Media Type</label>\n                <select class="form-select" name="media_type_${e}[]" id="media_type_${e}" multiple>\n                </select>\n            </div>\n            <div class="input-group mb-3" id="origin_${e}_container">\n                <label for="origin" class="input-group-text">Origin</label>\n                <select class="form-select" name="origin_${e}" id="origin_${e}">\n                    <option value=""></option>\n                </select>\n            </div>\n            <div class="input-group mb-3" id="post_attribution_${e}_container">\n                <label for="post_attribution" class="input-group-text">Post Attribution</label>\n                <select class="form-select" name="post_attribution_${e}" id="post_attribution_${e}">\n                    <option value=""></option>\n                </select>\n            </div>\n            <div class="input-group mb-3" id="video_type_${e}_container">\n                <label for="video_type" class="input-group-text">Video Type</label>\n                <select class="form-select" name="video_type_${e}[]" id="video_type_${e}" multiple>\n                </select>\n            </div>`);for(const e of Object.keys(SBKS.profiles_selected)){$postsSorts.append($(`\n            <div class="capitalize" style="padding: 8px 0 12px 0; margin-left: -5px">\n                <ion-icon style="vertical-align: sub; font-size: 22px;" \n                    title="${e}" name="${SBKS.icons[e]}"></ion-icon> \n                ${e}\n            </div>\n            ${filters(e)}\n            <div class="input-group mb-3">\n                <label class="input-group-text">Fields</label>\n                <select class="form-select" data-fields="${e}" name="${e}-fields[]"></select>          \n            </div>\n            <div class="input-group mb-3" style="${"twitter"===e?"display:none":""}">\n                <label class="input-group-text">Sort</label>\n                <select class="form-select" data-sort="${e}" name="${e}-sort[]" multiple></select>\n            </div>\n            <div class="row">\n                <div class="col">\n                    <div class="input-group mb-3" style="${"twitter"===e?"display:none":""}">\n                        <label class="input-group-text">Order</label>\n                        <select class="form-select" name="${e}-order">\n                            <option value="asc">Ascending</option>\n                            <option value="desc" selected>Descending</option>\n                        </select>\n                    </div>\n                </div>\n                <div class="col">\n                    <div class="input-group mb-3">\n                        <label class="input-group-text">Limit</label>\n                        <input type="number" min="1" max="100" value="100" class="form-control" name="${e}-limit">\n                    </div>\n                </div>\n            </div>\n        `));for(const[t,n]of Object.entries(POSTS_FILTER_FIELDS)){$.each(n[e],((n,a)=>{$(`#${t}_${e}`).append($("<option>",{value:a,text:a.charAt(0).toUpperCase()+a.slice(1)}))}));let a=document.getElementById(`${t}_${e}`);if(!a)continue;let i=a.options;(0===i.length||1===i.length&&""===i[0].value)&&$(`#${t}_${e}_container`).hide()}}}$((function(){$posts.submit(onPostsSubmit)})),$advancedFilteringSwitch.change(toggleAdvancedFiltering);let $profileMetrics=$("#profileMetrics"),$profileMetricsContent=$("#profileMetricsContent"),$profileMetricsSpinner=$("#profileMetricsSpinner").hide();async function onProfileMetricsSubmit(e){e.preventDefault(),$profileMetricsSpinner.show(),SBKS.profile_metrics={},SBKS.profile_dimensions={};let t=null;for(const e of $profileMetrics.serializeArray()){if("daterange"===e.name){SBKS.date_range=parseDateRange(e.value);continue}if("time"===e.name){e.value&&(t=e.value);continue}let[n,a]=e.name.split("-");SBKS.profile_dimensions[n]=SBKS.profile_dimensions[n]||[],SBKS.profile_metrics[n]=SBKS.profile_metrics[n]||[],t&&!SBKS.profile_dimensions[n].includes(t)&&SBKS.profile_dimensions[n].unshift(t),SBKS[a][n].push(e.value)}tableau.connectionData=JSON.stringify(SBKS),invokeConnector(SBKS.data_source)}function renderProfileMetrics(){$profileMetricsContent.html("");let e=[];for(const t of Object.keys(SBKS.profiles_selected))e=[...e,...Object.keys(SBKS.profiles_selected[t]).filter((e=>SBKS.profiles_with_no_labels[t].includes(e)))],$profileMetricsContent.append($(`\n            <div class="capitalize" style="padding: 8px 0 12px 0; margin-left: -5px">\n                <ion-icon style="vertical-align: sub; font-size: 22px;" \n                    title="${t}" name="${SBKS.icons[t]}"></ion-icon> \n                ${t}\n            </div>\n            \n            <div class="input-group mb-3">\n                <label class="input-group-text">Metrics</label>\n                <select class="form-select" data-network="${t}" data-type="profile_metrics" \n                        name="${t}-profile_metrics"></select>\n            </div>\n            <div class="input-group mb-3">\n                <label class="input-group-text">Dimensions</label>\n                <select class="form-select" data-network="${t}" data-type="profile_dimensions" \n                        name="${t}-profile_dimensions"></select>\n            </div>\n        `));e.length&&$profileMetricsContent.append($(`\n        <div class="alert alert-info" role="alert">\n            Some profiles you selected don't have profile labels. If you select profile_label as a dimension\n            the data for that profile will not be shown.<br>\n            Profiles: ${e.map((e=>SBKS.profile_name_by_id[e])).join(", ")}\n        </div>\n        `)),$profileMetrics.show(),initProfileMetricsAndDimensions()}function initProfileMetricsAndDimensions(){$("select").each((function(){$(this).outerWidth()>10&&$(this).css({width:$(this).outerWidth()-1+"px"})})),$("select[data-type=profile_metrics]").each((function(){let e=$(this),t=e.data("network"),n=Object.entries(SBKS.profiles_selected[t]).find((e=>e[1]?e:null));e.empty().select2({multiple:!0,data:Object.keys(PROFILE_METRICS[t]).map((e=>{if(n||0!==e.indexOf("insights"))return{id:e,text:e}}))})})).change((function(){let e=$(this),t=[],n=e.data("network");for(const a of e.val())t=t.length?intersect(t,PROFILE_METRICS[n][a]):PROFILE_METRICS[n][a];let a=$(`select[data-type=profile_dimensions][data-network=${n}]`),i=a.val();a.empty().select2({multiple:!0,data:t.map((e=>({id:e,text:e})))}).val(i&&i.length?i:["profile"]).trigger("change")})).trigger("change"),$(document).on("select2:select","select[data-type=dimensions]",(function(e){let t=e.params.data.id;if(PROFILE_COMMON_DIMENSIONS.includes(t))return;let n=$(this),a=n.val().filter((e=>PROFILE_COMMON_DIMENSIONS.includes(e)));a.push(t),n.val(a).trigger("change")}))}$((function(){$profileMetrics.submit(onProfileMetricsSubmit)}));let $profiles=$("#profiles"),$profilesSpinner=$("#profilesSpinner").hide(),$profilesTable=$("#profilesTable");async function onProfilesSubmit(e){e.preventDefault(),$profilesSpinner.show();let t=$profiles.serializeArray();for(const e of t){let t=e.name.split("_"),n=t[0];"profile"===t[1]&&(SBKS.profiles_selected[n]=SBKS.profiles_selected[n]||{},SBKS.profiles_selected[n][e.value]=!1)}for(const e of t){let t=e.name.split("_"),n=t[0];"insights"===t[1]&&(SBKS.profiles_selected[n]=SBKS.profiles_selected[n]||{},SBKS.profiles_selected[n][e.value]=!0)}for(const e of SBKS.profile_labels)for(const t of e.profiles)t.platform in SBKS.profiles_selected&&t.id in SBKS.profiles_selected[t.platform]&&e.selected_profiles.push(t);$profiles.hide(),"profile"===SBKS.data_source?renderProfileMetrics():"aggregated_post"===SBKS.data_source?renderAggregatedPostMetrics():"posts"===SBKS.data_source&&renderPosts()}function filterProfiles(e){for(const[t,n]of Object.entries(SBKS.profiles)){if(!n||!n.length)return;let a=!1;for(const t of n){let n=!e||t.name.match(new RegExp("("+e+")","gi"));a=a||n,$(`tr[data-profile-id='${t.id}']`).css("display",n?"":"none").attr("data-hidden",n?"0":"1")}$(`thead[data-network=${t}]`).css("display",a?"":"none").attr("data-hidden",a?"0":"1")}}function renderProfiles(){$profilesTable.html("");for(const[e,t]of Object.entries(SBKS.profiles)){if(!t||!t.length||"profile"===SBKS.data_source&&"vkontakte"===e)continue;$profilesTable.append($(`\n            <thead data-network="${e}">\n                <tr>\n                    <th style="width: 30px" title="Select all">\n                        <input class="form-check-input" type="checkbox" data-select-multiple="${e}_profile" />\n                    </th>\n                    <th>\n                        <ion-icon style="vertical-align: sub;font-size: 22px;"\n                            title="${e}" name="${SBKS.icons[e]}"></ion-icon> ${e}</th>\n                    <th>ID</th>\n                    <th>Insights</th>\n                    <th class="toggleTbody" title="Toggle"><ion-icon name="caret-up-outline"></ion-icon></th>\n                </tr>\n            </thead>`));let n=$(`<tbody data-network="${e}">`);for(const a of t)renderProfile(e,a,n);$profilesTable.append(n)}$profiles.show()}function renderProfile(e,t,n){n.append($(`<tr data-profile-id="${t.id}" data-hidden="0">\n               <td><input class="form-check-input" type="checkbox" name="${e}_profile" value="${t.id}"></td>\n               <td><img src="${t.picture}" alt="${t.name}"/> ${t.name}</td>\n               <td>${t.id}</td>\n               <td colspan="2">\n                   <input class="form-check-input" style="display: ${t.insights_enabled?"block":"none"}" \n                          type="checkbox" name="${e}_insights" value="${t.id}">\n               </td>\n           </tr>`))}$((function(){$profiles.submit(onProfilesSubmit),$("[data-source-type]").click((function(e){e.preventDefault(),SBKS.data_source=$(this).data("source-type"),$("#data_source").text($(this).text()),renderProfiles(),$("#search").keyup()})),$(document).on("change","[data-select-multiple]",(function(){let e=$(this);$(`tr[data-hidden=0] input[name=${e.data("select-multiple")}]`).each((function(){$(this).prop("checked",e.prop("checked")).change()}))})),$(document).on("change","input[type=checkbox][name$=_profile]",(function(){$("#profiles button[type=submit]").prop("disabled",!$("input[type=checkbox][name$=_profile]:checked").length)})),$(document).on("click","#profiles tbody tr",(function(e){if("checkbox"!==e.target.type){let e=$(this).find(":checkbox").first();e.prop("checked",!e.prop("checked")).change()}})),$(document).on("keyup","#search",(function(){if(filterProfiles($(this).val()),!$("tr[data-hidden=0]").length){let e=$(this),t=e.val();e.val(t.substring(0,t.length-1)).keyup()}})),$(document).on("click","th.toggleTbody",(function(){let e=$(this),t=e.parents("thead").data("network"),n=$(`tbody[data-network=${t}]`),a=e.find("ion-icon");"caret-up-outline"===a.attr("name")?(n.css("display","none"),a.attr("name","caret-down-outline")):(n.css("display",""),a.attr("name","caret-up-outline"))})),$("#clearSearch").click((function(){$("#search").val("").keyup()}))}));const MAX_PROFILES=100,MAX_METRICS=25,MAX_DAYS=360,MAX_POSTS_ARRAY_DEPTH=10;let tableauConnector=tableau.makeConnector();function invokeConnector(e){"profile"===e?tableau.connectionName="Socialbakers social media profiles":"aggregated_post"===e?tableau.connectionName="Socialbakers social media aggregated post metrics":"posts"===e&&(tableau.connectionName="Socialbakers social media posts"),tableau.submit()}tableauConnector.init=e=>{tableau.authType=tableau.authTypeEnum.custom,e()},tableauConnector.getSchema=e=>{let t=JSON.parse(tableau.connectionData),n=[];if("profile"===t.data_source){n.push({id:"platform",dataType:tableau.dataTypeEnum.string});for(const[e,a]of Object.entries(t.profile_metrics)){for(const e of a||[])n=appendMetricColumn(e,n);for(const a of t.profile_dimensions[e]||[])n=appendDimensionColumn(a,n,t)}}else if("aggregated_post"===t.data_source){for(const e of t.aggregated_post_metrics||[])n=appendMetricColumn(e,n);for(const e of t.aggregated_post_dimensions||[])n=appendDimensionColumn(e,n,t)}else if("posts"===t.data_source)for(const e of Object.values(t.posts_networks))for(const t of e.fields||[]){let e=POSTS_FIELDS[t];if(e.type)n=appendColumn(n,t,e.type);else if(e.array&&e.subfields)for(let a=1;a<10;a++)for(const[i,s]of Object.entries(e.subfields))n=appendColumn(n,`${t}_${i}_${a}`,s);else if(e.subfields)for(const[a,i]of Object.entries(e.subfields))n=appendColumn(n,`${t}_${a}`,i)}n.length&&e([{id:t.data_source,alias:t.data_source,columns:n}])},tableauConnector.getData=async(e,t)=>{let n=JSON.parse(tableau.connectionData);"profile"===n.data_source?e.appendRows(await getProfileData(n)):"aggregated_post"===n.data_source?e.appendRows(await getAggregatedPostData(n)):"posts"===n.data_source&&e.appendRows(await getPostsData(n)),t()},tableau.registerConnector(tableauConnector);
//# sourceMappingURL=all.js.map
